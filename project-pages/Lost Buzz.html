<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hodan Abdirahman">

<title>Lost Buzz: Tracking Trends and Factors in Bee Colony Losses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lost Buzz_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lost Buzz_files/libs/quarto-html/quarto.js"></script>
<script src="Lost Buzz_files/libs/quarto-html/popper.min.js"></script>
<script src="Lost Buzz_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lost Buzz_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lost Buzz_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lost Buzz_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lost Buzz_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lost Buzz_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lost Buzz_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lost Buzz: Tracking Trends and Factors in Bee Colony Losses</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hodan Abdirahman </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="key-threats" class="level2">
<h2 class="anchored" data-anchor-id="key-threats">Key Threats</h2>
<p>As a child, I feared bees for their painful stings without appreciating their vital ecological role. While stings are unpleasant, bees only sting to defend themselves and their hive. In fact, bees are prolific pollinators sustaining diverse ecosystems and enabling successful food crop production that our agricultural system relies on.</p>
<p>Declining bee populations from pesticides, habitat loss, climate change, and disease is alarming. My wariness of stings now mixes with awe at bees’ resilience. Though stings briefly hurt, I accept the discomfort knowing it connects me to the expansive pollination systems bees make possible.</p>
<p>My goal is to raise awareness of threats facing honeybees and their indispensable pollination services through data-driven storytelling.</p>
<p>Let’s begin by uploading the data. The data particular comes from U.S Department of Agriculture, but tidytuesday github has made it easier to load and extract.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>colony <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-11/colony.csv'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>stressor <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-01-11/stressor.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We will be implementing two various data sets.</p>
<p>The Colony data set, focuses on quantifying bee colonies directly, provides colony count and change metrics by year, month and state. Overall captures trajectory of total bee colonies and population changes.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,222 × 10
    year months        state     colony_n colony_max colony_lost colony_lost_pct
   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
 1  2015 January-March Alabama       7000       7000        1800              26
 2  2015 January-March Arizona      35000      35000        4600              13
 3  2015 January-March Arkansas     13000      14000        1500              11
 4  2015 January-March Californ…  1440000    1690000      255000              15
 5  2015 January-March Colorado      3500      12500        1500              12
 6  2015 January-March Connecti…     3900       3900         870              22
 7  2015 January-March Florida     305000     315000       42000              13
 8  2015 January-March Georgia     104000     105000       14500              14
 9  2015 January-March Hawaii       10500      10500         380               4
10  2015 January-March Idaho        81000      88000        3700               4
# ℹ 1,212 more rows
# ℹ 3 more variables: colony_added &lt;dbl&gt;, colony_reno &lt;dbl&gt;,
#   colony_reno_pct &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The stressor data set, focuses on external stress factors affecting be colonies -pesticides, diseases, climate etc. It links stressors to time frames and locations, as well as the impacts in percentage of colonies affect per quarter.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7,332 × 5
    year months        state   stressor              stress_pct
   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;                      &lt;dbl&gt;
 1  2015 January-March Alabama Varroa mites                10  
 2  2015 January-March Alabama Other pests/parasites        5.4
 3  2015 January-March Alabama Disesases                   NA  
 4  2015 January-March Alabama Pesticides                   2.2
 5  2015 January-March Alabama Other                        9.1
 6  2015 January-March Alabama Unknown                      9.4
 7  2015 January-March Arizona Varroa mites                26.9
 8  2015 January-March Arizona Other pests/parasites       20.5
 9  2015 January-March Arizona Disesases                    0.1
10  2015 January-March Arizona Pesticides                  NA  
# ℹ 7,322 more rows</code></pre>
</div>
</div>
<p>Im interested in understanding the changes in colony numbers over time in various US states. Let’s begin by examining data from six randomly selected states to gain a clearer perspective. To ensure diversity, I’ve chosen states from different regions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>states_sample<span class="ot">&lt;-</span>colony <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Oregon'</span>,<span class="st">'Iowa'</span>,<span class="st">'Louisiana'</span>,<span class="st">'Vermont'</span>,<span class="st">'California'</span>,<span class="st">'Pennsylvania'</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(states_sample, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> colony_n, <span class="at">color =</span> months)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> state, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Colony Numbers Over Time Across Different US States"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Colony Numbers"</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Most states display a similar pattern of fluctuation in colony numbers across years and months. For example, Pennsylvanian and Vermont display peaks in between fall to winter and fall rather than summer. Meanwhile, California stands out for having a relatively stable colony count over time, without the seasonal highs and lows seen in other states. One commonality is that all states are missing data for April through June of 2018. This gap in the middle of the year makes it difficult to fully assess seasonal trends for that time period. Additional years of data could help determine if 2018 is an anomaly or if spring months regularly lack measurements.</p>
</section>
<section id="overall-trends" class="level2">
<h2 class="anchored" data-anchor-id="overall-trends">Overall Trends</h2>
<p>This analysis looks at recent 5-year colony trends between 2015-2019 given the available data range. To prepare the data, I filtered the data set to only include complete years within this period for valid comparisons. Examining the states with extreme high or low net changes over this short time frame highlights rapidly improving or worsening areas that may warrant closer investigation.</p>
<p>This is the five states with the biggest growth:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is the five states with the biggest decline:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The slope charts reveal Texas as a dramatic positive outlier with a net growth of around 115,000 colonies, over double any other state. Florida, Michigan, Minnesota, and Wisconsin also saw substantial gains between 25,000 to 42,000. On the decline side, most states experienced gradual drops of -15,000 or less, but Ohio and Maryland saw steeper decreases nearing -50,000 colonies.</p>
<p>Seeing states like Texas and Florida with large expansions could point to favorable climates, land availability, or agricultural practices supporting beekeeping. Meanwhile, the states with steep declines may reflect urbanization pressure, reduced foraging habitat, or climate stresses negatively impacting colonies. Comparing adjoining states in different directions could help identify regional factors that differentiate success and struggles.</p>
<p>While these net changes highlight growth and declines, they do not account for proportional size differences among states. Larger states can have bigger swings in raw totals. Analyzing changes per existing colony or other metrics could improve normalization. Additionally, linking to stressor and land use data may reveal correlations to explore in future work.</p>
<p>The stressor data set does not directly quantify climate change impacts, it does include variables like disease prevalence that can be linked to weather factors. For example, research shows Varroa mite infestations increase when temperatures rise but decline during heavy rains and high winds (Rowland, 2021).</p>
<p>I want to explore the potential correlation between diseases affected by climate and colony loss rates. Specifically, we can use the data on Varroa mite effects as a proxy for temperature-sensitive diseases. If colonies affected by Varroa mites also exhibit higher loss percentages, it suggests a connection between increasing heat and colony collapses.</p>
<p><strong>E</strong>xamining relationships between diseases like Varroa mites and colony losses can provide indirect insight into how climate shifts may be impacting bee populations. While not a perfect measure, analyzing these available variables can act as a starting point.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(colony, stressor, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"months"</span>, <span class="st">"state"</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>mites_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stressor <span class="sc">==</span> <span class="st">"Varroa mites"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>correlation_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(mites_data<span class="sc">$</span>stress_pct, mites_data<span class="sc">$</span>colony_lost_pct)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>(correlation_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  mites_data$stress_pct and mites_data$colony_lost_pct
t = 7.9387, df = 1160, p-value = 4.793e-15
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.1717363 0.2808438
sample estimates:
      cor 
0.2270022 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mites_data, <span class="fu">aes</span>(<span class="at">x =</span> stress_pct, <span class="at">y =</span> colony_lost_pct)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">"brown"</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlation between Varroa mites and Colony Loss Rates"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Varroa mites"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Colony Loss Rates (%)"</span>)<span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As we can see there is a steady slow increase, between the factors of Varroa mites and the percentage of bee colonies lost.</p>
<p>The statistical test to measure the correlation, states there does seem to be a significant connection between these two factors. Specifically, the analysis showed that when a higher percentage of colonies have Varroa mite infestations, a higher percentage of colonies are also lost. And when fewer colonies have mites, fewer colonies are lost.</p>
<p>The correlation test suggested this is a moderate strength positive relationship, so the trends don’t match perfectly, but they seem closely related based on the data.</p>
<p>We can’t definitively prove the mites directly caused the losses from this. But the significant correlation does suggest that these medical issues faced by bee colonies are linked to their survival rates.</p>
</section>
<section id="geographic-patterns" class="level2">
<h2 class="anchored" data-anchor-id="geographic-patterns"><strong>Geographic Patterns</strong></h2>
<p>For this analysis we need to load sf package, as we are going to make a choropleth map of the United State. We want to find how colony losses vary across the continental. We might see some region vary in shade compared to other places.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and unzip shapefile </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"http://www2.census.gov/geo/tiger/GENZ2015/shp/cb_2015_us_state_20m.zip"</span>, <span class="at">destfile =</span> <span class="st">"states.zip"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"states.zip"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>shapefile <span class="ot">&lt;-</span> <span class="st">"cb_2015_us_state_20m.shp"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>states_needed <span class="ot">&lt;-</span> <span class="fu">st_read</span>(shapefile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `cb_2015_us_state_20m' from data source 
  `C:\Users\abdir\Downloads\R- In Class practice\cb_2015_us_state_20m.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 52 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -179.1743 ymin: 17.91377 xmax: 179.7739 ymax: 71.35256
Geodetic CRS:  NAD83</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(states_needed, colony, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NAME"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_data, <span class="fu">aes</span>(<span class="at">fill =</span> colony_max)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">65</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Colony Losses Across the US"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Colony Losses"</span>) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">'mako'</span>) <span class="sc">+</span>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Based on the map data, there isn’t a strikingly significant difference in color indicating regional patterns of colony loss rates across the United States. However, certain states do stand out with higher losses, notably California, which recorded over estimated around 900,000 colony losses.</p>
<p>California’s major agricultural industry likely explains its high colony losses. As the top producer of many bee-pollinated crops like almonds, declines in honey bee health could significantly impact crop pollination and food production there. California also has major commercial beekeeping operations that are affected by high mortality rates.</p>
<p>According to an article by Aaron Smith, California produces about 80% of the world’s almonds in over 1 million acres of orchards. In February, 90% of all US honey bees are transported there to pollinate almond blooms. This reliance on imported bees, despite increasing almond acreage, may pressure honey bee health.</p>
<p>States like Texas and Florida saw growth in colonies over the past five years. Texas has gained beekeeping popularity and implemented supportive regulations. Florida produced 8 million pounds of honey in 2021 from over 650,000 colonies( <a href="https://www.nass.usda.gov/Surveys/Guide_to_NASS_Surveys/Bee_and_Honey/">USDA 2022</a>) However, its climate also aids bee pests and diseases that can raise colony los</p>
<p>In summary, the enormous role of agriculture and bee-pollinated crops in states like California, Texas, and Florida make honey bee health especially important. Their large commercial operations and warmer climates also introduce stressors that can negatively impact colonies. Managing bee health in major farm states is key to supporting crop pollination and food supply nationwide.</p>
</section>
<section id="seasonal-analysis" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-analysis">Seasonal Analysis</h2>
<p>Understanding if certain stressors consistently peak seasonally can identify critical time periods to target interventions. A stacked bar visualization summarizes monthly stressor prevalence to reveal hazardous seasons. If the data shows clearly defined periods of increased stressors, we can target protective measures during those vulnerable seasons.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Varroa mites clearly have the highest prevalence, affirming earlier correlations with colony losses. Other pests and parasites also show substantial impacts across years and seasons.</p>
<p>Pesticide usage peaks between July-September, likely coinciding with crop treatments. Pesticide exposure can have complex immediate and long-term consequences on bee health depending on various factors.</p>
<p>The Other stressor category highlights gaps in current understanding. It potentially includes threats like weather extremes, habitat loss, new pathogens, and genetics. Better characterizing factors underlying colony declines is an area needing further exploration.</p>
<p><strong>F</strong>actors such as parasites, pesticides, and climate events are key contributors to concerning declines in bee populations, though their impact levels might change over time. Studying stressor trends allows us to identify whether specific stressors are becoming more or less influential. By employing a stacked area chart, we can visualize the cumulative impacts over multiple years, shedding light on intensifying threats and assessing the progress made in dealing with existing challenges. Monitoring stressors provides valuable insights for prioritizing solutions and making informed projections.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The stacked area chart shows some fluctuating stressor impacts early each year, potentially due to seasonal or data collection factors. Varroa mites consistently have the highest impact across all years.</p>
<p>The “Other” stressors, assumed to be environmental threats like weather extremes, reached a low point in 2020. Similarly, unidentified factors were also lower that year compared to prior years.</p>
<p>In contrast, parasites and pesticides display concerning upward trajectories over the time period. Research links pesticides to health issues like farmer poisonings and environmental contamination, yet industry sales continue rising (Rueter, 2022).</p>
<p>While some stressors fluctuate, likely from seasonal shifts, the escalation of parasites and pesticides indicates persisting and growing threats. Despite known damages, certain stressors are increasing as profits take priority over protecting pollinator health.</p>
</section>
<section id="intervention-analysis" class="level2">
<h2 class="anchored" data-anchor-id="intervention-analysis"><strong>Intervention Analysis</strong></h2>
<p>Beekeepers employ a variety of management practices to maintain hive health and counteract losses, including techniques like requeening colonies or replacing old comb.</p>
<p>It’s essential to know how often beekeepers in different places improve their hives. This helps us figure out where to focus on teaching and providing financial help to those who need it the most. By comparing states, we can see which areas are doing well and which ones need more support. Here let’s see which states have seen the biggest growth in renovation rates over the past decade?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>colony_chg <span class="ot">&lt;-</span> colony <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">chg =</span> <span class="fu">last</span>(colony_reno_pct) <span class="sc">-</span> <span class="fu">first</span>(colony_reno_pct))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Take top 5 by largest increase</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>top_states <span class="ot">&lt;-</span> colony_chg <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">"Other States"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(chg)) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_states, <span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> chg)) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill=</span> <span class="st">"lightblue"</span>)<span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> chg), <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"States with the Most Colony Renovation Percentage Growth"</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"States"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Avg Renovation %"</span>) <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The states with the highest growth in colony renovation rates over the past quinquennial are concentrated in the southern and western regions of the country. Arkansas saw the greatest average increase at 49%, followed by other states like New Mexico, Arizona, Oregon, and Tennessee.</p>
<p>Arkansas’ high rate may be partially attributed to the discovery that lineages of early European honeybees, thought to be extinct, still persist there. As discussed in a High Plains Journal article, these bees likely adapted to thrive in Arkansas’ climate and rich biodiversity, including 400-650 native bee species. The adapted genetics could necessitate more active colony management through renovations.</p>
<p>In general, several factors could be driving higher renovation rates in these states. Agricultural demands for specialty crop pollination in western states like Oregon may motivate interventions to strengthen colonies. Some states may also offer tax incentives promoting beekeeper renovation activities.</p>
<p>However, negative pressures like urbanization and habitat loss in rapidly developing areas can also force increased hive manipulations to compensate. Disease and pest problems require renovations to replenish colonies. A mix of positives like pollination needs and negatives like diseases and urbanization are likely spurring renovations in the top states.</p>
<p>While the specific reasons vary, the concentration of high renovation rate increases in southern and western states points to regional traits and incentives influencing beekeeper hive management decisions. Identifying the distinct drivers in each state can guide policies to support healthy bee populations (Miller, 2023).</p>
<p><strong>T</strong>he level of active “renovation” interventions varies based on the needs of each apiary. Understanding if higher renovation rates in a state correspond to reduced colony losses can provide insight into whether these labor-intensive practices are an effective strategy for improving outcomes.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The data reveals a clear negative correlation between yearly state-level colony renovation rates and colony loss rate. As renovation rates increase across states, loss rates decline. This suggests renovation helps protect colony health and prevent losses.</p>
<p>Beekeepers employ various renovation techniques to rejuvenate hives.This includes requeening colonies with new young queens for improved productivity( NASS). Brood pattern manipulation like culling drone comb to limit Varroa mite reproduction. Splitting large hives into multiple smaller colonies to prevent swarming. Sanitizing equipment with irradiation to reduce disease pathogens.</p>
<p>These targeted manipulations provide benefits like lowered infestations and infections, stronger brood development, and overall restoring of colonies. However, renovations also result in costs of time, labor, and equipment that must be balanced. Frequent splitting can also reduce honey yields in the short term.</p>
<p><strong>F</strong>urther research can help improve these strategies, ensuring that they provide maximum benefits while causing minimal disturbances from the interventions.</p>
</section>
<section id="clustering-analysis" class="level2">
<h2 class="anchored" data-anchor-id="clustering-analysis">Clustering Analysis</h2>
<p>Clustering is a technique of data segmentation that partitions the data into several groups based on their similarity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> colony</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(colony)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(colony_n, colony_added, state)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># scale the data</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> selected_columns <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">colony_added_scaled =</span> <span class="fu">scale</span>(colony_added))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># hierarchical clustering using hclust</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>hclust_model <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(scaled_data[, <span class="fu">c</span>(<span class="st">"colony_n"</span>, <span class="st">"colony_added_scaled"</span>)]))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hclust_model, k)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>scaled_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clusters)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scaled_data, <span class="fu">aes</span>(<span class="at">x =</span> colony_n, <span class="at">y =</span> colony_added_scaled, <span class="at">color =</span> cluster, <span class="at">label =</span> state)) <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span>  <span class="co"># Add state labels</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Clustering of Colony Data"</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Colonies"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Colonies Added (Scaled)"</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Lost-Buzz_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The clustering plot shows a positive correlation between the two variables. When a state, like California, appears in multiple clusters, it indicates that California’s colony data has unique characteristics setting it apart from other states. Possible reasons include distinct beekeeping practices, different environmental conditions, or agricultural activities. Additionally, the availability of comprehensive data for California compared to other states might contribute to more stable and consistent clustering results.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>The research indicates that bee populations are declining overall, and there are specific seasonal, regional, and stress-related patterns in how colonies are affected. The main threats to bees include Varroa mites, pesticides, and changes in land use.</p>
<p>To address this decline and support beekeepers, targeted solutions are needed. These solutions should involve strategic interventions that promote sustainable pollination services. It’s crucial to base these efforts on data analysis to ensure they are evidence-based and effective.</p>
<p>Moreover, continuous monitoring of the stressors affecting bee colonies and the interventions implemented is vital. This allows us to adapt our protection measures as threats evolve over time.</p>
<p>By being diligent and innovative in our approach, we can create a resilient future for both bees and agriculture, ensuring a healthy ecosystem and ample food production.</p>
<p>There are more than 20,000 known bee species worldwide, with approximately 4,000 of them native to the United States (USGS).</p>
<p>Native bees have been present in the United States long before European honeybees were introduced by settlers. While honeybees play a crucial role in pollinating certain crops like almonds and lemons, native bees, such as the blue orchard bees, excel at pollinating many crops, especially those that evolved in the Americas. Some native bees, like bumblebees, can perform “buzz pollination.” They vibrate their flight muscles while attached to a flower, causing the release of pollen, which is essential for certain plants’ pollination. In fact, native bees are estimated to pollinate around 80 percent of flowering plants worldwide.</p>
<p>This raises important questions around whether current conservation efforts are focused on the right bee species.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references"><strong>References</strong></h2>
<ol type="1">
<li><p>Bees | National Wildlife Federation. (n.d.). Retrieved from <a href="https://www.nwf.org/Educational-Resources/Wildlife-Guide/Invertebrates/Bees"><strong>https://www.nwf.org/Educational-Resources/Wildlife-Guide/Invertebrates/Bees</strong></a></p></li>
<li><p>How many species of native bees are in the United States? | U.S. Geological Survey. (n.d.). U.S. Geological Survey. Retrieved from <a href="https://www.usgs.gov/faqs/how-many-species-native-bees-are-united-states"><strong>https://www.usgs.gov/faqs/how-many-species-native-bees-are-united-states</strong></a></p></li>
<li><p>Miller, F. (2023, June 25). Researchers trace ancestry of Arkansas honeybees to original ‘colonists’ | Livestock | hpj.com. HPJ. <a href="https://www.hpj.com/livestock/researchers-trace-ancestry-of-arkansas-honeybees-to-original-colonists/article_97a8f88e-2a28-11ee-88df-7bb007a206b1.html"><strong>https://www.hpj.com/livestock/researchers-trace-ancestry-of-arkansas-honeybees-to-original-colonists/article_97a8f88e-2a28-11ee-88df-7bb007a206b1.html</strong></a></p></li>
<li><p>Rowland, B. (2021, November 9). Climatic drivers of honey bee disease - Press Office - Newcastle University. Newcastle University. <a href="https://www.ncl.ac.uk/press/articles/latest/2021/11/climaticdriversofhoneybeedisease/"><strong>https://www.ncl.ac.uk/press/articles/latest/2021/11/climaticdriversofhoneybeedisease/</strong></a></p></li>
<li><p>Rueter, G. (2022, December 1). Rising pesticides use harming farmers, environment: report – DW – 01/12/2022. DW. <a href="https://www.dw.com/en/pesticide-atlas-2022/a-60390427"><strong>https://www.dw.com/en/pesticide-atlas-2022/a-60390427</strong></a></p></li>
<li><p>USDA - National Agricultural Statistics Service - Surveys - Honey Bee Surveys and Reports. (2022, October 5). USDA. <a href="https://www.nass.usda.gov/Surveys/Guide_to_NASS_Surveys/Bee_and_Honey/"><strong>https://www.nass.usda.gov/Surveys/Guide_to_NASS_Surveys/Bee_and_Honey/</strong></a></p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>